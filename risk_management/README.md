# Модуль `risk_management`

Модуль `risk_management` отвечает за контроль и управление рисками в торговой системе. Он обеспечивает соблюдение установленных лимитов, рассчитывает размеры позиций и адаптирует торговые параметры на основе рыночных условий и качества ML-сигналов.

---

## Архитектура модуля

Архитектура модуля построена вокруг `RiskManager`, который выступает в роли центрального координатора. Он использует различные калькуляторы и адаптеры для принятия решений.

1.  **`RiskManager` (`manager.py`):** Принимает торговый сигнал и проверяет его на соответствие глобальным правилам (например, максимальное количество открытых позиций, общий риск на портфель).
2.  **`RiskCalculator` (`calculators.py`):** Содержит базовые функции для расчета размера позиции на основе заданного процента риска от депозита и уровней стоп-лосс.
3.  **`MLSignalAdapter` (`ml_risk_adapter.py`):** Адаптер, который анализирует "сырые" предсказания от ML-модели, оценивает их качество и на основе этого предлагает корректировки для стандартных параметров риска (например, увеличить размер позиции при высокой уверенности модели или уменьшить при высоком риске).

---

## Структура модуля

| Файл / Директория | Описание |
| :--- | :--- |
| **`manager.py`** | **(Ключевой компонент)** `RiskManager`. Центральный класс, который проверяет все торговые сигналы на соответствие правилам риск-менеджмента. |
| **`calculators.py`** | Содержит `RiskCalculator` с базовыми формулами для расчета размера позиции и соотношения риск/прибыль. |
| **`enhanced_calculator.py`** | Содержит `EnhancedRiskCalculator` — расширенную версию калькулятора, которая может использовать ML-данные для более точных расчетов. |
| **`ml_risk_adapter.py`** | `MLSignalAdapter`. Адаптер для интеграции с ML-моделью. Анализирует предсказания и адаптирует под них параметры риска. |
| **`portfolio/`** | Логика для управления рисками на уровне всего портфеля. |
| **`position/`** | Логика для управления рисками на уровне отдельной позиции. |
| **`sltp/`** | Компоненты, связанные с управлением Stop Loss и Take Profit. **Примечание:** функциональность может пересекаться с `trading/sltp/`. |