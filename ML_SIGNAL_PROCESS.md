# Процесс генерации ML сигналов в BOT_AI_V3

## Как работает система сигналов

### 1. **Частота генерации сигналов**

По умолчанию система настроена на генерацию сигналов **каждые 60 секунд** (1 минута), а не каждые 15 минут.

Конфигурация из `config/system.yaml`:

```yaml
ml:
  signal_interval: 60  # секунд
```

### 2. **Компоненты системы**

#### **SignalScheduler** (`ml/signal_scheduler.py`)

- Запускает отдельный асинхронный процесс для каждого символа
- Генерирует сигналы с интервалом `signal_interval_seconds` (60 сек)
- Работает параллельно для всех символов из конфигурации

#### **MLSignalProcessor** (`ml/ml_signal_processor.py`)

- Получает OHLCV данные из БД
- Использует **15-минутные свечи** для анализа
- Кеширует предсказания на 15 минут (`cache_ttl = 900`)
- Вызывает ML модель для генерации предсказаний

### 3. **Процесс работы**

```
Каждые 60 секунд:
1. SignalScheduler запускает генерацию для каждого символа
2. MLSignalProcessor проверяет кеш (TTL = 15 минут)
   - Если есть в кеше → использует сохраненное предсказание
   - Если нет → загружает 200 последних 15-минутных свечей из БД
3. Генерирует признаки (240 features)
4. Получает предсказание от ML модели
5. Создает торговый сигнал если:
   - confidence > 0.45
   - signal_strength > 0.2
6. Сигнал отправляется в TradingEngine
```

### 4. **Временные рамки**

- **Интервал проверки**: 60 секунд
- **Данные для анализа**: 15-минутные свечи
- **Кеш предсказаний**: 15 минут
- **История для ML**: 200 свечей (50 часов)

### 5. **Настройка интервалов**

Чтобы изменить частоту генерации сигналов:

1. В `config/ml/ml_config.yaml` добавить:

```yaml
signal_interval_seconds: 900  # 15 минут
```

2. Или в `config/system.yaml`:

```yaml
ml:
  signal_interval: 900  # 15 минут в секундах
```

### 6. **Оптимизация**

Текущая система оптимизирована для:

- **Частых проверок** (каждую минуту) для быстрой реакции
- **Экономии ресурсов** через кеширование на 15 минут
- **Использования 15-минутных данных** для стабильных предсказаний

### 7. **Запуск ML торговли**

```bash
# Запуск с ML сигналами
python3 unified_launcher.py --mode=ml

# Или напрямую планировщик
python3 ml/signal_scheduler.py
```

## Итог

Система генерирует сигналы **каждую минуту**, но использует **15-минутные свечи** и кеширует ML предсказания на **15 минут**. Это позволяет быстро реагировать на изменения рынка, но не перегружать ML модель лишними вычислениями.
