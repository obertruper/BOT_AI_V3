# Конфигурация ML трейдера для BOT_AI_V3
# Пример настройки трейдера с PatchTST ML стратегией

# Уникальный идентификатор трейдера
id: "ml_trader_01"

# Имя трейдера для отображения
name: "ML PatchTST Trader"

# Описание
description: "Трейдер на основе ML модели PatchTST для предсказания движений цены"

# Статус трейдера
enabled: true

# Биржа для торговли
exchange: "bybit"  # bybit, binance, okx, bitget, gateio, kucoin, huobi

# Торговая пара
symbol: "BTC/USDT"

# Стратегия
strategy: "PatchTSTStrategy"  # Имя класса стратегии из strategies/ml_strategy/

# Параметры стратегии (переопределяют дефолтные из patchtst_config.yaml)
strategy_config:
  # Пути к моделям
  models:
    model_path: "models/saved/best_model_20250728_215703.pth"
    scaler_path: "models/saved/data_scaler.pkl"

  # Параметры торговли
  trading:
    min_confidence: 0.70  # Повышенная уверенность для этого трейдера
    min_profit_probability: 0.75
    position_sizing_mode: "kelly"
    kelly_safety_factor: 0.20  # Консервативный подход

  # Веса таймфреймов для этого трейдера
  timeframe_weights:
    15m: 0.40   # Больше веса краткосрочным
    1h: 0.30
    4h: 0.20
    12h: 0.10

# Параметры риск-менеджмента
risk_management:
  # Максимальный риск на сделку (% от баланса)
  max_risk_per_trade: 0.02  # 2%

  # Максимальный риск на весь портфель
  max_portfolio_risk: 0.06  # 6%

  # Максимальное количество одновременных позиций
  max_positions: 2

  # Максимальный размер позиции (% от баланса)
  max_position_size: 0.10  # 10%

  # Stop-loss параметры
  stop_loss:
    enabled: true
    type: "dynamic"  # fixed, dynamic, trailing
    value: 0.02  # 2% для fixed, множитель ATR для dynamic

  # Take-profit параметры
  take_profit:
    enabled: true
    type: "dynamic"
    risk_reward_ratio: 2.5  # Минимум 2.5:1

  # Trailing stop
  trailing_stop:
    enabled: true
    activation_profit: 0.02  # Активация после 2% прибыли
    distance: 0.01  # 1% от текущей цены

# Баланс и лимиты
trading_limits:
  # Начальный баланс для трейдера (в USDT)
  initial_balance: 10000

  # Минимальный баланс (остановка при достижении)
  min_balance: 8000

  # Максимальная просадка
  max_drawdown: 0.20  # 20%

  # Дневные лимиты
  daily_loss_limit: 0.05  # 5% от баланса
  daily_trade_limit: 10  # Максимум сделок в день

# Временные ограничения
time_restrictions:
  # Торговые часы (UTC)
  trading_hours:
    start: "00:00"
    end: "23:59"

  # Дни недели (1-7, где 1 - понедельник)
  trading_days: [1, 2, 3, 4, 5]  # Пн-Пт

  # Избегать определенных периодов
  blackout_periods:
    - start: "07:00"
      end: "07:30"
      reason: "Высокая волатильность при открытии азиатской сессии"

# Параметры исполнения
execution:
  # Тип ордеров
  order_type: "limit"  # market, limit

  # Проскальзывание для лимитных ордеров
  limit_price_offset: 0.0001  # 0.01%

  # Таймаут для лимитных ордеров (секунды)
  order_timeout: 30

  # Количество попыток исполнения
  max_retries: 3

  # Задержка между попытками (секунды)
  retry_delay: 5

# Мониторинг и логирование
monitoring:
  # Уровень логирования для этого трейдера
  log_level: "INFO"

  # Отправка уведомлений
  notifications:
    telegram: true
    email: false

  # Метрики для отслеживания
  track_metrics:
    - "win_rate"
    - "profit_factor"
    - "sharpe_ratio"
    - "max_drawdown"
    - "average_trade_duration"

  # Интервал обновления метрик (минуты)
  metrics_update_interval: 15

# Специфичные настройки для ML стратегии
ml_specific:
  # Обновление модели
  model_update:
    enabled: false  # Автоматическое переобучение выключено
    check_interval_hours: 24
    min_performance_degradation: 0.10  # 10% падение точности

  # Валидация предсказаний
  prediction_validation:
    enabled: true
    min_sample_confidence: 0.5  # Минимальная уверенность выборки
    outlier_detection: true
    outlier_threshold: 3.0  # Z-score

  # A/B тестирование
  ab_testing:
    enabled: false
    control_allocation: 0.2  # 20% трейдов без ML

# Бэктестинг параметры (для валидации)
backtesting:
  enabled: true
  period_days: 30
  initial_capital: 10000
  commission: 0.001  # 0.1%
  slippage: 0.0005  # 0.05%

# Дополнительные настройки
advanced:
  # Использование GPU для inference
  use_gpu: true

  # Кэширование предсказаний
  cache_predictions: true
  cache_ttl: 60  # секунд

  # Параллельная обработка
  parallel_inference: true
  max_workers: 4
