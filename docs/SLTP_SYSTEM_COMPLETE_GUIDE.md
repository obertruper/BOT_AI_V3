# üìñ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ SL/TP –≤ BOT_AI_V3

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
4. [–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã](#–ø—Ä–æ—Ü–µ—Å—Å-—Ä–∞–±–æ—Ç—ã)
5. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
6. [API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#api-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
7. [–†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#—Ä–µ—à–µ–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
8. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
9. [–û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–æ—Ç–ª–∞–¥–∫–∞-–∏-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
10. [FAQ](#faq)

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ Stop Loss / Take Profit (SL/TP) –≤ BOT_AI_V3 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏ –∏ —Ñ–∏–∫—Å–∞—Ü–∏—é –ø—Ä–∏–±—ã–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ SL/TP —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ hedge –∏ one-way —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 7+ –∫—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∞–º–∏
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø, —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
- ‚úÖ –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ YAML

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Signal Source  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Trading Engine  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Order Manager  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                           ‚îÇ
                                                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Exchange API  ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  Order Executor  ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ SLTP Integration‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ Enhanced SLTP    ‚îÇ
                        ‚îÇ    Manager       ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. **OrderExecutor** (`/trading/order_executor.py`)

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫—É SL/TP –Ω–∞ –±–∏—Ä–∂–µ.

```python
class OrderExecutor:
    async def execute_order(self, order: Order) -> bool:
        # 1. –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ä–¥–µ—Ä–∞ –Ω–∞ –±–∏—Ä–∂—É
        exchange_order = await exchange.create_order(**order_params)

        # 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SL/TP —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
        if order.stop_loss or order.take_profit:
            await self._set_sltp_for_order(order, exchange)
```

### 2. **EnhancedSLTPManager** (`/trading/sltp/enhanced_manager.py`)

–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏.

```python
class EnhancedSLTPManager:
    # –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    - create_sltp_orders()      # –°–æ–∑–¥–∞–Ω–∏–µ SL/TP –æ—Ä–¥–µ—Ä–æ–≤
    - update_trailing_stop()    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø–∞
    - apply_profit_protection() # –ó–∞—â–∏—Ç–∞ –ø—Ä–∏–±—ã–ª–∏
    - handle_partial_close()    # –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
```

### 3. **SLTPIntegration** (`/trading/orders/sltp_integration.py`)

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π –º–µ–∂–¥—É OrderManager –∏ SLTPManager.

```python
class SLTPIntegration:
    async def handle_filled_order(self, order: Order, exchange) -> bool:
        # –°–æ–∑–¥–∞–Ω–∏–µ SL/TP –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞
        return await self.create_sltp_for_order(order, exchange)
```

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞

```python
signal = Signal(
    symbol="BTCUSDT",
    signal_type=SignalType.LONG,
    entry_price=50000,
    stop_loss=48500,    # -3%
    take_profit=52500   # +5%
)
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞

```python
# Trading Engine –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª
order = await order_manager.create_order_from_signal(signal)
```

### 3. –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞

```python
# OrderExecutor –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –±–∏—Ä–∂—É
success = await order_executor.execute_order(order)
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SL/TP

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞
async def _set_sltp_for_order(self, order: Order, exchange):
    params = {
        "category": "linear",
        "symbol": order.symbol,
        "tpslMode": "Full",
        "positionIdx": position_idx,
        "stopLoss": str(order.stop_loss),
        "takeProfit": str(order.take_profit)
    }

    response = await client._make_request(
        "POST", "/v5/position/trading-stop", params, auth=True
    )
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### `/config/system.yaml`

```yaml
trading:
  hedge_mode: true              # –†–µ–∂–∏–º —Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏—è
  min_order_value_usdt: 5.0     # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞

  # –†–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  default_position_sizes:
    BTCUSDT: 0.001    # ~$50 –ø—Ä–∏ —Ü–µ–Ω–µ $50k
    ETHUSDT: 0.02     # ~$50 –ø—Ä–∏ —Ü–µ–Ω–µ $2.5k
    SOLUSDT: 0.25     # ~$50 –ø—Ä–∏ —Ü–µ–Ω–µ $200

  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ SL/TP –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  default_sltp:
    stop_loss_percent: 2.0      # 2% —Å—Ç–æ–ø-–ª–æ—Å—Å
    take_profit_percent: 3.0    # 3% —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç
```

### `/config/sltp/enhanced.yaml`

```yaml
sltp:
  # –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  enabled: true
  mode: aggressive  # conservative, moderate, aggressive

  # –¢—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø
  trailing_stop:
    enabled: true
    activation_profit: 1.5    # –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏ 1.5% –ø—Ä–∏–±—ã–ª–∏
    trailing_distance: 0.5    # –û—Ç—Å—Ç—É–ø 0.5%

  # –ó–∞—â–∏—Ç–∞ –ø—Ä–∏–±—ã–ª–∏
  profit_protection:
    enabled: true
    breakeven_at: 1.0         # –ë–µ–∑—É–±—ã—Ç–æ–∫ –ø—Ä–∏ 1% –ø—Ä–∏–±—ã–ª–∏
    lock_profit_levels:
      - trigger: 2.0          # –ü—Ä–∏ 2% –ø—Ä–∏–±—ã–ª–∏
        lock: 1.0             # –ó–∞—â–∏—Ç–∏—Ç—å 1%
      - trigger: 5.0          # –ü—Ä–∏ 5% –ø—Ä–∏–±—ã–ª–∏
        lock: 3.0             # –ó–∞—â–∏—Ç–∏—Ç—å 3%

  # –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
  partial_close:
    enabled: true
    levels:
      - profit: 2.0           # –ü—Ä–∏ 2% –ø—Ä–∏–±—ã–ª–∏
        close: 25             # –ó–∞–∫—Ä—ã—Ç—å 25%
      - profit: 5.0           # –ü—Ä–∏ 5% –ø—Ä–∏–±—ã–ª–∏
        close: 50             # –ó–∞–∫—Ä—ã—Ç—å –µ—â–µ 50%
```

## üîå API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### Bybit API v5

```python
# Endpoint –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ SL/TP
POST /v5/position/trading-stop

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
{
    "category": "linear",      # –¢–∏–ø –ø—Ä–æ–¥—É–∫—Ç–∞
    "symbol": "BTCUSDT",      # –¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞
    "tpslMode": "Full",       # –†–µ–∂–∏–º SL/TP (Full/Partial)
    "positionIdx": 0,         # 0: one-way, 1: hedge-buy, 2: hedge-sell
    "stopLoss": "48500",      # –¶–µ–Ω–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
    "takeProfit": "52500"     # –¶–µ–Ω–∞ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞
}
```

### Position Index –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö

- **One-way mode**: `positionIdx = 0`
- **Hedge mode**:
  - BUY/LONG: `positionIdx = 1`
  - SELL/SHORT: `positionIdx = 2`

## üêõ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—à–∏–±–∫–∞ enum –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞**: `invalid input value for enum signaltype: 'long'`

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ uppercase –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

```python
# /trading/engine.py:501
"signal_type": signal.signal_type.value.upper()
```

### 2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: `Order does not meet minimum order value 5USDT`

**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞

```python
# /trading/engine.py:1089
min_order_value_usdt = Decimal(str(
    self.config.get("trading", {}).get("min_order_value_usdt", 5.0)
))

if position_value_usdt < min_order_value_usdt:
    min_quantity = min_order_value_usdt / current_price
    adjusted_quantity = min_quantity * Decimal("1.1")  # +10% –∑–∞–ø–∞—Å
```

### 3. SL/TP –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏—Å—å –Ω–∞ –±–∏—Ä–∂–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: SL/TP —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ –ë–î, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –Ω–∞ –±–∏—Ä–∂—É

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞

```python
# /trading/order_executor.py:111
if order.stop_loss or order.take_profit:
    await self._set_sltp_for_order(order, exchange)
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ —Å SL/TP

```python
from database.models.signal import Signal, SignalType

signal = Signal(
    symbol="ETHUSDT",
    signal_type=SignalType.LONG,
    entry_price=2500.0,
    stop_loss=2450.0,     # -2%
    take_profit=2575.0,   # +3%
    source="ml_strategy",
    metadata={
        "confidence": 0.85,
        "ml_score": 0.92
    }
)

# –≠–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª
await signal_generator.emit_signal(signal)
```

### 2. –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ SL/TP

```python
# –°–∫—Ä–∏–ø—Ç set_sltp_on_exchange.py
exchange = await factory.create_and_connect("bybit")
positions = await exchange.get_positions()

for pos in positions:
    if pos.side.upper() == "BUY":
        sl_price = float(pos.entry_price) * 0.98  # -2%
        tp_price = float(pos.entry_price) * 1.03  # +3%
    else:
        sl_price = float(pos.entry_price) * 1.02  # +2%
        tp_price = float(pos.entry_price) * 0.97  # -3%

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ API
    params = {
        "category": "linear",
        "symbol": pos.symbol,
        "tpslMode": "Full",
        "stopLoss": str(sl_price),
        "takeProfit": str(tp_price),
        "positionIdx": position_idx
    }

    response = await client._make_request(
        "POST", "/v5/position/trading-stop", params, auth=True
    )
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö SL/TP

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
orders = await AsyncPGPool.fetch("""
    SELECT id, symbol, side, stop_loss, take_profit, status
    FROM orders
    WHERE status = 'OPEN'
    AND stop_loss IS NOT NULL
    ORDER BY created_at DESC
""")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–∏—Ä–∂–µ
positions = await exchange.get_positions()
for pos in positions:
    print(f"{pos.symbol}: SL={pos.stop_loss}, TP={pos.take_profit}")
```

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SL/TP –æ–ø–µ—Ä–∞—Ü–∏–π
tail -f ./data/logs/bot_trading_*.log | grep -E "set_sltp_for_order|SL/TP"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫
grep -E "ERROR.*sltp|ERROR.*stop.*loss" ./data/logs/bot_trading_*.log
```

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤ —Å SL/TP
SELECT
    id,
    symbol,
    side,
    quantity,
    stop_loss,
    take_profit,
    status,
    created_at
FROM orders
WHERE stop_loss IS NOT NULL
ORDER BY created_at DESC
LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ SL/TP
SELECT
    COUNT(*) as total_orders,
    COUNT(stop_loss) as with_sl,
    COUNT(take_profit) as with_tp,
    AVG(CASE
        WHEN side = 'BUY' THEN (entry_price - stop_loss) / entry_price * 100
        ELSE (stop_loss - entry_price) / entry_price * 100
    END) as avg_sl_percent
FROM orders
WHERE created_at > NOW() - INTERVAL '24 hours';
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```python
# –°–∫—Ä–∏–ø—Ç monitor_sltp.py
async def monitor_sltp():
    while True:
        positions = await exchange.get_positions()

        for pos in positions:
            if pos.size > 0:
                print(f"\n{datetime.now()}")
                print(f"Symbol: {pos.symbol}")
                print(f"Side: {pos.side}")
                print(f"Entry: {pos.entry_price}")
                print(f"Current: {pos.mark_price}")
                print(f"SL: {pos.stop_loss or 'NOT SET'}")
                print(f"TP: {pos.take_profit or 'NOT SET'}")
                print(f"PnL: {pos.unrealized_pnl}")

        await asyncio.sleep(30)  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
```

## ‚ùì FAQ

### Q: –ü–æ—á–µ–º—É SL/TP –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è?

**A**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. API –∫–ª—é—á–∏ –≤ `.env` —Ñ–∞–π–ª–µ
2. –†–µ–∂–∏–º –ø–æ–∑–∏—Ü–∏–π (hedge/one-way) –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞ ($5 –¥–ª—è Bybit)
4. –õ–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ API

### Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç SL/TP –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?

**A**: –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/config/system.yaml`:

```yaml
trading:
  default_sltp:
    stop_loss_percent: 3.0    # –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ 3%
    take_profit_percent: 5.0  # –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ 5%
```

### Q: –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É SL/TP?

**A**: –í `/config/sltp/enhanced.yaml`:

```yaml
sltp:
  enabled: false  # –û—Ç–∫–ª—é—á–∏—Ç—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É SL/TP
```

### Q: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ª–∏ –¥—Ä—É–≥–∏–µ –±–∏—Ä–∂–∏ –∫—Ä–æ–º–µ Bybit?

**A**: –î–∞, —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

- Binance
- OKX
- Bitget
- KuCoin
- Gate.io
- MEXC

–ö–∞–∂–¥–∞—è –±–∏—Ä–∂–∞ –∏–º–µ–µ—Ç —Å–≤–æ–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ API –¥–ª—è SL/TP.

### Q: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø?

**A**: –¢—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–ª–µ–¥—É–µ—Ç –∑–∞ —Ü–µ–Ω–æ–π:

1. –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1.5%)
2. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
3. –î–≤–∏–≥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å—Ç–æ—Ä–æ–Ω—É –ø—Ä–∏–±—ã–ª–∏, –Ω–∏–∫–æ–≥–¥–∞ –ø—Ä–æ—Ç–∏–≤

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ SL/TP –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä?

**A**: –î–∞, —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–ª–∏ –ø—Ä—è–º–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –≤ —Å–∏–≥–Ω–∞–ª–µ:

```python
# –í —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
if symbol == "BTCUSDT":
    sl_percent = 1.5  # –ú–µ–Ω—å—à–∏–π —Ä–∏—Å–∫ –¥–ª—è BTC
elif symbol in ["DOGEUSDT", "SHIBUSDT"]:
    sl_percent = 5.0  # –ë–æ–ª—å—à–∏–π —Ä–∏—Å–∫ –¥–ª—è –º–µ–º-–∫–æ–∏–Ω–æ–≤
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Bybit API Documentation](https://bybit-exchange.github.io/docs/v5/position/trading-stop)
- [Risk Management Best Practices](./RISK_MANAGEMENT_GUIDE.md)
- [Trading Strategy Development](./STRATEGY_DEVELOPMENT.md)
- [System Architecture Overview](./ARCHITECTURE.md)

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 10.08.2025
**–ê–≤—Ç–æ—Ä**: Claude AI
