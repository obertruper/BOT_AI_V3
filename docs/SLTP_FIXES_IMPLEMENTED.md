# üìö –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è SL/TP —Å–∏—Å—Ç–µ–º—ã BOT_AI_V3

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (10.08.2025)

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ enum –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞**: `invalid input value for enum signaltype: 'long'` - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–∂–∏–¥–∞–µ—Ç uppercase –∑–Ω–∞—á–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**:

- –§–∞–π–ª: `/trading/engine.py:501`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ signal_type –≤ uppercase –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î:

```python
"signal_type": (
    signal.signal_type.value.upper()
    if hasattr(signal.signal_type, "value")
    else str(signal.signal_type).upper()
),
```

### 2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –æ—Ä–¥–µ—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: `Order does not meet minimum order value 5USDT` - Bybit —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º $5 –Ω–∞ –æ—Ä–¥–µ—Ä

**–†–µ—à–µ–Ω–∏–µ**:

- –§–∞–π–ª: `/config/system.yaml`
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `min_order_value_usdt: 5.0`
  - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä

- –§–∞–π–ª: `/trading/engine.py:1089-1135`
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ –æ—Ä–¥–µ—Ä–∞
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–∏–Ω–∏–º—É–º—É

### 3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ SL/TP –Ω–∞ –±–∏—Ä–∂–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: SL/TP —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ –ë–î, –Ω–æ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏—Å—å –Ω–∞ –±–∏—Ä–∂–µ Bybit

**–†–µ—à–µ–Ω–∏–µ**:

- –§–∞–π–ª: `/trading/order_executor.py`
  - –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `_set_sltp_for_order()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞ (—Å—Ç—Ä–æ–∫–∞ 113)
  - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `_set_sltp_for_order()` (—Å—Ç—Ä–æ–∫–∏ 193-241):
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ hedge/one-way —Ä–µ–∂–∏–º–∞
    - –ü—Ä—è–º–æ–π API –≤—ã–∑–æ–≤ –∫ Bybit `/v5/position/trading-stop`
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã API Bybit –¥–ª—è SL/TP

```python
params = {
    "category": "linear",
    "symbol": order.symbol,
    "tpslMode": "Full",  # –ü–æ–ª–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
    "positionIdx": position_idx,  # 0 –¥–ª—è one-way, 1/2 –¥–ª—è hedge
    "stopLoss": str(order.stop_loss),
    "takeProfit": str(order.take_profit)
}
```

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ position index

- One-way mode: `positionIdx = 0`
- Hedge mode:
  - BUY/LONG: `positionIdx = 1`
  - SELL/SHORT: `positionIdx = 2`

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

- –§–∞–π–ª: `/set_sltp_on_exchange.py`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç SL/TP –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ API

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
SELECT id, symbol, side, quantity, status, stop_loss, take_profit, created_at
FROM orders
WHERE created_at > NOW() - INTERVAL '1 hour'
ORDER BY created_at DESC;
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

```bash
grep -E "set_sltp_for_order|–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º SL/TP|set_trading_stop" ./data/logs/bot_trading_*.log
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –¢—Ä–µ–±—É—é—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–µ API –∫–ª—é—á–∏ Bybit –≤ `.env`:

   ```
   BYBIT_API_KEY=–≤–∞—à_–∫–ª—é—á
   BYBIT_API_SECRET=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç
   ```

2. **–†–µ–∂–∏–º –ø–æ–∑–∏—Ü–∏–π**: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç hedge/one-way —Ä–µ–∂–∏–º –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã**: –í—Å–µ –æ—Ä–¥–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–∏–Ω–∏–º—É–º—É $5

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

- ‚úÖ –û—Ä–¥–µ—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ enum –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- ‚úÖ –†–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –±–∏—Ä–∂–∏
- ‚úÖ SL/TP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–∞ –±–∏—Ä–∂–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –≤ hedge, —Ç–∞–∫ –∏ –≤ one-way —Ä–µ–∂–∏–º–µ

## üìù –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å BOT_AI_V2

–í –≤–µ—Ä—Å–∏–∏ V2 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –º–µ—Ç–æ–¥ `set_trading_stop()` –∏–∑ –º–æ–¥—É–ª—è `api.client`.
–í V3 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ API –∫–ª–∏–µ–Ω—Ç –±–∏—Ä–∂–∏ —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

---

**–ê–≤—Ç–æ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**: Claude AI
**–î–∞—Ç–∞**: 10.08.2025
