# üìë –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ SL/TP –≤ BOT_AI_V3

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫** (10.08.2025)

#### üîß –û—à–∏–±–∫–∞ enum –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

- **–§–∞–π–ª**: `/trading/engine.py:501`
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ë–î –æ–∂–∏–¥–∞–ª–∞ uppercase –∑–Ω–∞—á–µ–Ω–∏—è ('LONG' –≤–º–µ—Å—Ç–æ 'long')
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `.upper()`

#### üí∞ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞

- **–§–∞–π–ª—ã**: `/config/system.yaml`, `/trading/engine.py:1089-1135`
- **–ü—Ä–æ–±–ª–µ–º–∞**: Bybit —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º $5 –Ω–∞ –æ—Ä–¥–µ—Ä
- **–†–µ—à–µ–Ω–∏–µ**:
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `min_order_value_usdt: 5.0`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏

### 2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ SL/TP**

#### üéØ –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ

- **–§–∞–π–ª**: `/trading/order_executor.py`
- **–î–æ–±–∞–≤–ª–µ–Ω–æ**:

  ```python
  # –°—Ç—Ä–æ–∫–∞ 111-115
  if order.stop_loss or order.take_profit:
      await self._set_sltp_for_order(order, exchange)

  # –°—Ç—Ä–æ–∫–∏ 193-241 - –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
  async def _set_sltp_for_order(self, order: Order, exchange):
      # –ü—Ä—è–º–æ–π API –≤—ã–∑–æ–≤ –∫ Bybit
      response = await client._make_request(
          "POST", "/v5/position/trading-stop", params, auth=True
      )
  ```

## üìç –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `/trading/order_executor.py` | –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ + —É—Å—Ç–∞–Ω–æ–≤–∫–∞ SL/TP |
| `/trading/engine.py` | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤, —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ |
| `/trading/sltp/enhanced_manager.py` | –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ SL/TP |
| `/config/system.yaml` | –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
| `/config/sltp/enhanced.yaml` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ SL/TP |

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
1. –°–∏–≥–Ω–∞–ª ‚Üí 2. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ ‚Üí 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –±–∏—Ä–∂—É ‚Üí 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SL/TP
                                                              ‚Üì
                                                    API: /v5/position/trading-stop
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cat config/system.yaml | grep -E "hedge_mode|min_order_value"

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
python3 unified_launcher.py --mode=ml

# 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å SL/TP
tail -f ./data/logs/bot_trading_*.log | grep "SL/TP"

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏
python3 check_positions_and_sltp.py
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **API –∫–ª—é—á–∏** –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `.env`:

   ```
   BYBIT_API_KEY=xxx
   BYBIT_API_SECRET=xxx
   ```

2. **–†–µ–∂–∏–º –ø–æ–∑–∏—Ü–∏–π** –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –±–∏—Ä–∂–µ–π:

   ```yaml
   trading:
     hedge_mode: true  # –∏–ª–∏ false
   ```

3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è –¥–æ $5

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ —Å SL/TP
SELECT id, symbol, side, stop_loss, take_profit, status
FROM orders
WHERE stop_loss IS NOT NULL
ORDER BY created_at DESC
LIMIT 10;
```

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `grep ERROR ./data/logs/bot_trading_*.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏: `cat .env | grep BYBIT`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `python3 test_sltp_fix.py`
4. –°–º. [SLTP_TROUBLESHOOTING.md](./SLTP_TROUBLESHOOTING.md)

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
**–î–∞—Ç–∞**: 10.08.2025
**–í–µ—Ä—Å–∏—è**: 3.0
