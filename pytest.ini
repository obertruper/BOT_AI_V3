[pytest]
# Базовые настройки
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Поддержка asyncio
asyncio_mode = auto

# Маркеры для группировки тестов
markers =
    asyncio: mark test as async
    unit: Unit tests for individual components
    integration: Integration tests for multiple components
    performance: Performance and load tests
    ml: Machine Learning specific tests
    slow: Tests that take more than 5 seconds
    requires_db: Tests requiring database connection
    requires_gpu: Tests requiring GPU/CUDA
    requires_exchange: Tests requiring exchange API
    smoke: Quick smoke tests for CI
    database: Database tests
    requires_redis: Tests that require redis
    sltp: Dynamic SL/TP (Stop Loss/Take Profit) tests
    e2e: End-to-end tests

# Опции по умолчанию
addopts =
    -v
    --tb=short
    --strict-markers
    --maxfail=3
    --ff

# Настройки покрытия
[coverage:run]
source = .
omit =
    */tests/*
    */test_*
    */__pycache__/*
    */venv/*
    */migrations/*
    setup.py
    conftest.py

# Игнорируемые директории
norecursedirs =
    .git
    .tox
    dist
    build
    *.egg
    venv
    __pycache__
    .pytest_cache
    htmlcov
    .coverage
    web/frontend/node_modules

# Настройки вывода
console_output_style = progress
junit_family = xunit2

# Таймауты (если установлен pytest-timeout)
# timeout = 300
# timeout_method = thread

# Настройки для параллельного запуска
# Раскомментировать при использовании pytest-xdist
# addopts = -n auto

# Фильтрация предупреждений
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::FutureWarning:torch.*
    error::UserWarning:ml.*
