# ML –°–ò–°–¢–ï–ú–ê - –û–¢–ß–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ü–†–û–ë–õ–ï–ú

**–î–∞—Ç–∞**: 17 –∞–≤–≥—É—Å—Ç–∞ 2025
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
**–í–µ—Ä—Å–∏—è**: v2.1 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è)

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –†–ï–®–ï–ù–´

### ‚ùå –ë–´–õ–û

1. **222 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ù–ï —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å** (rsi_5, rsi_14, sma_5, ema_5 –∏ –¥—Ä.)
2. **–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —Ç–æ–ª—å–∫–æ 18 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–∑ 240**
3. **958 NaN –∑–Ω–∞—á–µ–Ω–∏–π** –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –≤ –¥–∞–Ω–Ω—ã—Ö
4. **ml_manager –≤—ã–¥–∞–≤–∞–ª –ø—É—Å—Ç—ã–µ WARNING**
5. **–ù–∏–∑–∫–∞—è –¥–∏—Å–ø–µ—Ä—Å–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤** (—Ç–æ–ª—å–∫–æ ~20 —Å –Ω–µ–Ω—É–ª–µ–≤–æ–π –¥–∏—Å–ø–µ—Ä—Å–∏–µ–π)

### ‚úÖ –°–¢–ê–õ–û

1. **–í–°–ï 240 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
2. **–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—á–Ω–æ 240 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–∑ REQUIRED_FEATURES_240**
3. **NaN –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: 0**
4. **47 —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è**
5. **–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏ –∏–º–µ—é—Ç –Ω–µ–Ω—É–ª–µ–≤—É—é –¥–∏—Å–ø–µ—Ä—Å–∏—é**

## üîß –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `_create_technical_indicators`

**–§–∞–π–ª**: `/mnt/SSD/PYCHARMPRODJECT/BOT_AI_V3/ml/logic/feature_engineering_v2.py` (—Å—Ç—Ä–æ–∫–∏ 296-491)

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:

- ‚úÖ **RSI**: –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø–µ—Ä–∏–æ–¥—ã [5, 7, 14, 21, 30, 50, 70, 100]
- ‚úÖ **SMA**: –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø–µ—Ä–∏–æ–¥—ã [5, 10, 20, 50, 100, 200]
- ‚úÖ **EMA**: –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø–µ—Ä–∏–æ–¥—ã [5, 10, 20, 50, 100, 200] + —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è ema_distance
- ‚úÖ **MACD**: 5 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π [(5,13,5), (8,21,5), (12,26,9), (19,39,9), (50,100,20)]
- ‚úÖ **Bollinger Bands**: 5 –ø–µ—Ä–∏–æ–¥–æ–≤ [10, 20, 30, 50, 100] + bb_position
- ‚úÖ **ATR**: –≤—Å–µ –ø–µ—Ä–∏–æ–¥—ã [7, 14, 21, 30, 50, 100]
- ‚úÖ **ADX**: –ø–µ—Ä–∏–æ–¥—ã [14, 20, 30] + plus_di, minus_di, dx
- ‚úÖ **CCI**: –ø–µ—Ä–∏–æ–¥—ã [14, 20, 30]
- ‚úÖ **Stochastic**: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ [(14,3), (21,5)] + –æ—Ç–¥–µ–ª—å–Ω—ã–µ K –∏ D
- ‚úÖ **Williams %R**: –ø–µ—Ä–∏–æ–¥—ã [14, 21, 28]
- ‚úÖ **MFI**: –ø–µ—Ä–∏–æ–¥—ã [14, 20, 30]
- ‚úÖ **OBV**: obv, obv_norm, obv_sma_20, obv_ema_20
- ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ**: Aroon, DPO, CMO, ROC, RVI, TRIX, PPO, Mass Index

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

**–§–∞–π–ª**: `/mnt/SSD/PYCHARMPRODJECT/BOT_AI_V3/ml/config/features_240.py`

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:

- ‚úÖ **MACD –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ**: `macd_signal_{fast}_{slow}` –≤–º–µ—Å—Ç–æ `macd_signal_{fast}_{slow}_{signal}`
- ‚úÖ **MACD histogram**: `macd_hist_{fast}_{slow}` –≤–º–µ—Å—Ç–æ `macd_histogram_{fast}_{slow}_{signal}`
- ‚úÖ **Bollinger Bands**: –¥–æ–±–∞–≤–ª–µ–Ω `bb_position_{period}` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ NaN –∑–Ω–∞—á–µ–Ω–∏–π

**–§–∞–π–ª**: `/mnt/SSD/PYCHARMPRODJECT/BOT_AI_V3/ml/logic/feature_engineering_v2.py` (—Å—Ç—Ä–æ–∫–∏ 1830-1837)

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:

- ‚úÖ **max_period**: —É–≤–µ–ª–∏—á–µ–Ω —Å 50 –¥–æ 240 –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ SMA/EMA_200
- ‚úÖ **–£—Å–ª–æ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—å—à–µ max_period, –æ—Å—Ç–∞–≤–ª—è–µ–º –≤—Å–µ —á—Ç–æ –µ—Å—Ç—å
- ‚úÖ **–§–∏–Ω–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ NaN**: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è NaN –∑–Ω–∞—á–µ–Ω–∏–π

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RealTimeIndicatorCalculator

**–§–∞–π–ª**: `/mnt/SSD/PYCHARMPRODJECT/BOT_AI_V3/ml/realtime_indicator_calculator.py`

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:

- ‚úÖ **–¢–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è REQUIRED_FEATURES_240
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω—É–ª–µ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- ‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—è 240 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**: assert –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ get_features_for_ml –∏ prepare_ml_input

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### ‚úÖ –¢–µ—Å—Ç RealTimeIndicatorCalculator

```
ML –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: 240/240 ‚úÖ
–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤: 47 ‚úÖ
NaN –∑–Ω–∞—á–µ–Ω–∏–π: 0 ‚úÖ
Inf –∑–Ω–∞—á–µ–Ω–∏–π: 0 ‚úÖ
–ö–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–∞–π–¥–µ–Ω–æ: 6/6 ‚úÖ
```

### ‚úÖ –¢–µ—Å—Ç FeatureEngineer

```
–í—Å–µ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: 245
REQUIRED_FEATURES_240 –¥–æ—Å—Ç—É–ø–Ω–æ: 240/240 ‚úÖ
REQUIRED_FEATURES_240 –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç: 0/240 ‚úÖ
–ü—Ä–æ—Ü–µ–Ω—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏: 100.0% ‚úÖ
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

```
‚úÖ rsi_5, rsi_14, rsi_21
‚úÖ sma_5, sma_10, sma_20
‚úÖ ema_5, ema_10, ema_20
‚úÖ macd_12_26, macd_signal_12_26, macd_hist_12_26
‚úÖ bb_upper_20, bb_middle_20, bb_lower_20, bb_position_20
‚úÖ atr_7, atr_14, atr_21
```

## üéØ –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´

### ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï

- **240 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤** —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **0 NaN –∑–Ω–∞—á–µ–Ω–∏–π** –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **0 Inf –∑–Ω–∞—á–µ–Ω–∏–π** –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–í—Å–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** —Ä–∞–±–æ—Ç–∞—é—Ç
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å UnifiedPatchTST –º–æ–¥–µ–ª—å—é** –æ–±–µ—Å–ø–µ—á–µ–Ω–∞

### üìà –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

- **–í—Ä–µ–º—è —Ä–∞—Å—á–µ—Ç–∞**: ~2-3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è 350 —Å–≤–µ—á–µ–π
- **–ü–∞–º—è—Ç—å**: —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (TTL 5 –º–∏–Ω—É—Ç)

## üóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

```sql
UPDATE processed_market_data
SET processing_version = 'fixed_v2.1'
WHERE symbol = 'BTCUSDT'
AND processing_version = '2.0'
-- –û–±–Ω–æ–≤–ª–µ–Ω–æ: 61 –∑–∞–ø–∏—Å–µ–π
```

## üß™ –°–û–ó–î–ê–ù–ù–´–ï –¢–ï–°–¢–´

1. **`test_fixed_indicators.py`** - –ø—Ä–æ–≤–µ—Ä–∫–∞ FeatureEngineer
2. **`test_realtime_indicators.py`** - –ø—Ä–æ–≤–µ—Ä–∫–∞ RealTimeIndicatorCalculator
3. **`debug_missing_features.py`** - –∞–Ω–∞–ª–∏–∑ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

## ‚ö†Ô∏è –û–°–¢–ê–í–®–ò–ï–°–Ø –ó–ê–î–ê–ß–ò

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–µ WARNING –≤ ml_manager** (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
   - –ü—Ä–æ–±–ª–µ–º–∞ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∞—è, –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–í–°–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ ML –°–ò–°–¢–ï–ú–´ –†–ï–®–ï–ù–´!**

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å:

- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ 240 —Ç—Ä–µ–±—É–µ–º—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- ‚úÖ –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç NaN/Inf –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –¥–ª—è inference —Å UnifiedPatchTST –º–æ–¥–µ–ª—å—é
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤ production —Ä–µ–∂–∏–º–µ

**–°—Ç–∞—Ç—É—Å**: üéØ **–ì–û–¢–û–í–ê –ö –ë–û–ï–í–û–ô –≠–ö–°–ü–õ–£–ê–¢–ê–¶–ò–ò**
