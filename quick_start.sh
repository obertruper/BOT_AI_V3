#!/bin/bash

# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ BOT_AI_V3 —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

echo "üöÄ –ó–∞–ø—É—Å–∫ BOT_AI_V3 Trading Bot"
echo "================================"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "unified_launcher.py" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ BOT_AI_V3"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ ! -d "venv" ]; then
    echo "‚ùå –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
    echo "–°–æ–∑–¥–∞—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
    python3 -m venv venv
fi

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è venv
source venv/bin/activate

# –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞
if [ ! -f ".env" ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "–ö–æ–ø–∏—Ä—É—é .env.example..."
    cp .env.example .env
    echo "‚ö†Ô∏è  –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ API –∫–ª—é—á–∏ –±–∏—Ä–∂!"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–µ–π
if ! grep -q "BYBIT_API_KEY=.*[a-zA-Z0-9]" .env; then
    echo "‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: API –∫–ª—é—á–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ .env"
    echo "   –ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ —Å–∏–º—É–ª—è—Ü–∏–∏"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL
if ! psql -p 5555 -U obertruper -d bot_trading_v3 -c "SELECT 1" > /dev/null 2>&1; then
    echo "‚ùå PostgreSQL –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5555"
    echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    exit 1
fi

echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã"
echo ""

# –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∑–∞–ø—É—Å–∫–∞:"
echo "1) ML Trading (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)"
echo "2) –ü—Ä–æ—Å—Ç–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –±–µ–∑ ML"
echo "3) –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º)"
echo "4) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å"
echo "5) –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞"

read -p "–í—ã–±–æ—Ä (1-5): " choice

case $choice in
    1)
        echo "üöÄ –ó–∞–ø—É—Å–∫ ML Trading..."
        python3 unified_launcher.py --mode=ml --logs
        ;;
    2)
        echo "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Å—Ç–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏..."
        python3 unified_launcher.py --mode=core --logs
        ;;
    3)
        echo "üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤..."
        python3 unified_launcher.py --logs
        ;;
    4)
        echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
        python3 unified_launcher.py --status
        ;;
    5)
        echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞..."
        python3 unified_launcher.py --stop
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        exit 1
        ;;
esac
