# Реальные 240 признаков из feature_engineering_production.py
REAL_FEATURES_240 = [
    "open",
    "high",
    "low",
    "close",
    "volume",
    "turnover",
    "returns",
    "returns_5",
    "returns_10",
    "returns_20",
    "high_low_ratio",
    "close_open_ratio",
    "close_position",
    "volume_ratio",
    "turnover_ratio",
    "vwap",
    "close_vwap_ratio",
    "vwap_extreme_deviation",
    "sma_5",
    "close_sma_5_ratio",
    "sma_10",
    "close_sma_10_ratio",
    "sma_20",
    "close_sma_20_ratio",
    "sma_50",
    "close_sma_50_ratio",
    "ema_10",
    "close_ema_10_ratio",
    "ema_20",
    "close_ema_20_ratio",
    "ema_50",
    "close_ema_50_ratio",
    "rsi",
    "rsi_oversold",
    "rsi_overbought",
    "macd",
    "macd_signal",
    "macd_diff",
    "bb_high",
    "bb_low",
    "bb_middle",
    "bb_width",
    "bb_position",
    "bb_breakout_upper",
    "bb_breakout_lower",
    "bb_breakout_strength",
    "atr",
    "atr_pct",
    "stoch_k",
    "stoch_d",
    "adx",
    "adx_pos",
    "adx_neg",
    "psar",
    "psar_trend",
    "psar_distance",
    "psar_distance_normalized",
    "ichimoku_conversion",
    "ichimoku_base",
    "ichimoku_span_a",
    "ichimoku_span_b",
    "ichimoku_cloud_thickness",
    "price_vs_cloud",
    "keltner_upper",
    "keltner_middle",
    "keltner_lower",
    "keltner_position",
    "donchian_upper",
    "donchian_middle",
    "donchian_lower",
    "donchian_breakout",
    "vwma_20",
    "close_vwma_ratio",
    "mfi",
    "mfi_overbought",
    "mfi_oversold",
    "cci",
    "cci_overbought",
    "cci_oversold",
    "williams_r",
    "ultimate_oscillator",
    "accumulation_distribution",
    "obv",
    "obv_ema",
    "obv_trend",
    "cmf",
    "adxr",
    "aroon_up",
    "aroon_down",
    "aroon_oscillator",
    "pivot",
    "resistance1",
    "support1",
    "resistance2",
    "support2",
    "dist_to_resistance1",
    "dist_to_support1",
    "roc",
    "trix",
    "hl_spread",
    "hl_spread_ma",
    "price_direction",
    "directed_volume",
    "volume_imbalance",
    "dollar_volume",
    "price_impact",
    "price_impact_log",
    "toxicity",
    "amihud_illiquidity",
    "amihud_ma",
    "kyle_lambda",
    "volatility_volume_ratio",
    "realized_vol_1h",
    "realized_vol_daily",
    "realized_vol_annual",
    "realized_vol",
    "volume_volatility_ratio",
    "volume_cumsum_4h",
    "volume_cumsum_4h_ratio",
    "volume_cumsum_8h",
    "volume_cumsum_8h_ratio",
    "volume_cumsum_12h",
    "volume_cumsum_12h_ratio",
    "volume_cumsum_24h",
    "volume_cumsum_24h_ratio",
    "volume_zscore",
    "volume_spike",
    "volume_spike_magnitude",
    "local_high_20",
    "local_low_20",
    "distance_from_high_20",
    "distance_from_low_20",
    "position_in_range_20",
    "local_high_50",
    "local_low_50",
    "distance_from_high_50",
    "distance_from_low_50",
    "position_in_range_50",
    "local_high_100",
    "local_low_100",
    "distance_from_high_100",
    "distance_from_low_100",
    "position_in_range_100",
    "volatility_squeeze",
    "volatility_squeeze_duration",
    "bearish_divergence_rsi",
    "bullish_divergence_rsi",
    "bearish_divergence_macd",
    "bullish_divergence_macd",
    "obv_normalized",
    "obv_divergence",
    "momentum_1h",
    "momentum_4h",
    "momentum_24h",
    "momentum_acceleration",
    "spring_pattern",
    "indicators_consensus_long",
    "indicators_count_long",
    "indicators_consensus_short",
    "indicators_count_short",
    "trend_1h",
    "trend_1h_strength",
    "trend_4h",
    "trend_4h_strength",
    "daily_high",
    "daily_low",
    "daily_range",
    "position_in_daily_range",
    "near_daily_high",
    "near_daily_low",
    "uptrend_structure",
    "downtrend_structure",
    "news_risk",
    "liquidity_score",
    "liquidity_rank",
    "signal_strength",
    "long_liquidation_price",
    "short_liquidation_price",
    "long_liquidation_distance_pct",
    "short_liquidation_distance_pct",
    "current_leverage",
    "long_liquidation_risk",
    "short_liquidation_risk",
    "optimal_leverage",
    "safe_leverage",
    "cascade_risk",
    "funding_proxy",
    "long_holding_cost_daily",
    "short_holding_cost_daily",
    "var_95",
    "recommended_position_size",
    "hurst_exponent",
    "fractal_dimension",
    "efficiency_ratio",
    "trend_quality",
    "realized_vol_5m",
    "realized_vol_15m",
    "garch_vol",
    "vol_regime",
    "return_entropy",
    "btc_beta",
    "idio_vol",
    "returns_ac_1",
    "returns_ac_5",
    "returns_ac_10",
    "price_jump",
    "jump_intensity",
    "ofi_persistence",
    "vpin",
    "liquidity_adj_returns",
    "cvar_5pct",
    "hour",
    "minute",
    "hour_sin",
    "hour_cos",
    "dayofweek",
    "is_weekend",
    "dow_sin",
    "dow_cos",
    "day",
    "month",
    "month_sin",
    "month_cos",
    "asian_session",
    "european_session",
    "american_session",
    "session_overlap",
    "long_tp1_time",
    "long_tp2_time",
    "long_tp3_time",
    "long_sl_time",
    "short_tp1_time",
    "short_tp2_time",
    "short_tp3_time",
    "short_sl_time",
    "long_expected_value",
    "short_expected_value",
    "long_optimal_entry_time",
    "long_optimal_entry_price",
    "long_optimal_entry_improvement",
]

# Всего: 240 признаков

# Алиасы для обратной совместимости
PRODUCTION_FEATURES = REAL_FEATURES_240
REQUIRED_FEATURES_231 = REAL_FEATURES_240[:231]  # Для кода, который ожидает 231

# Критические формулы
CRITICAL_FORMULAS = {
    "returns": "np.log(close / close.shift(1))",
    "volatility": "returns.rolling(window).std()",
    "rsi": "ta.momentum.RSIIndicator(close, window).rsi()",
    "bollinger_bands": "ta.volatility.BollingerBands(close, window)",
    "macd": "ta.trend.MACD(close, window_fast, window_slow, window_sign)",
    "volume_ratio": "volume / volume.rolling(20).mean()",
    "high_low_ratio": "high / low",
    "atr": "ta.volatility.AverageTrueRange(high, low, close, window).average_true_range()"
}
